<!DOCTYPE html>
<html>
<head>
    <meta charset = "UTF-8">
    <title>Create Place Guide</title>
    <script src = "./maps/api_key.js"></script>
    <script id = "maps-api" async defer></script>
    <link rel = "stylesheet" href = "style.css">
</head>
<body onload = "setApiKeyAndMapsCallback()">
    <header> 
        <ul>
            <li><a href = "index.html">Home</a></li>
            <li><a href = "discover.html">Discover</a></li>
            <li><a href = "myPlaceGuides.html">My PlaceGuides</a></li>
            <li><a href = "createPlaceGuide.html">Create PlaceGuide</a></li>
        </ul>
    </header>

    <input id = "search-box" type = "text" placeholder = "Search for a new place!"/>
    <div id = "map"></div>

    <script src = "./maps/geolocation.js"></script>
    <script src = "./maps/searchbox.js"></script>
    <script src = "./maps/place.js"></script>
    <script src = "./maps/show_places.js"></script>
    <script src = "./maps/click_location.js"></script>
    <script src = "./maps/save_location.js"></script>
    <script src="https://unpkg.com/@google/markerclustererplus@4.0.1/dist/markerclustererplus.min.js"></script>
    <script> 
        /** 
        * This function initialises the map and adds some functionalities to it:
        * Geolocation: to track the user's current location, display it and center the map around it.
        * Choose location: the user can choose  alocation through the searchbox, 
        * by clicking on any point on the map, by clicnking on a POI or by moving the marker of the chosen location.
        * Save location: lets the user save the currently chosen location for the place guide creation.
        * Display place guides: displays the place guides created by the currently logged in user.
        */
        function createMap() {
            var myMapOptions = {
                zoom: 2,
                center: new google.maps.LatLng(0, 0),
                mapTypeId: 'roadmap',
                restriction: {latLngBounds: {north: 85, south: -85, west: -180, east: 180}, strictBounds: true}
            };
            const map = new google.maps.Map(
                document.getElementById('map'), myMapOptions);

            // Geolocation functionality.
            var geolocator = new Geolocator(map);
            geolocator.init();

            // Choose location functionality.
            // Remark that chosenLocation can be updated from the SearchBox and by clicking as well.
            var chosenLocation = new Place(0, 0, "Picked Location", null, PlaceType.SEARCH_RESULT, true);
            chosenLocation.draggable = true;
            chosenLocation.map = map;
            var searchBox = new SearchBox(map, chosenLocation, "search-box");
            searchBox.init();
            enableChoosingLocationByClick(map, chosenLocation);

            // Save location functionality.
            var locationSaver = new LocationSaver(map, chosenLocation);
            locationSaver.init();

            // Display user's place guides functionality.
            // The user's ID is hardcoded for now, but it will be fetched from the server in the future.
            var userId = "test";
            PlaceDisplayer.displayPlaceGuidesOfUser(map, userId);
        }
    </script>
</body>
</html>